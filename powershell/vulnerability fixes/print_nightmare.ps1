# This script is intended to automatically manage the print spooler in Windows by either
# disabling or re-enabling it, and starting or stopping it as required.  This was written
# as a mitigation for PrintNightmare, CVE-2021-34481, and other similar exploits.

# Must be run in elevated Powershell session, because Windows is weird that way.

# Gets current status of print spooler service and assigns array output to variable
$service = Get-WMIObject win32_service -filter "name='spooler'"
# Stops and disables service if start mode is set to Auto or Manual
if ($service.StartMode -eq 'Auto' -OR $service.StartMode -eq 'Manual') {
    # Required because Powershell handles services weirdly; have to stop it manually before disabling it,
    # rather than all in one line.
    Get-Service -Name 'spooler' | Stop-Service
    Set-Service -Name 'spooler' -Status Stopped -StartupType Disabled
} else {
    # Sets spooler startup type to Auto and starts the service
    Set-Service -Name 'spooler' -Status Running -StartupType Auto
}